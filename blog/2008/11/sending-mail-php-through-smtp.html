<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" href="/public/stylesheets/bs.css"> <link rel="stylesheet" href="/public/stylesheets/styles.css"> <link rel="stylesheet" href="/public/stylesheets/pygment_trac.css"> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"> <link rel="canonical" href="http://jamesarmes.com/blog/2008/11/sending-mail-php-through-smtp"> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script> <link rel="icon" type="image/x-icon" href="/favicon.ico"/> <title>Sending Mail In PHP Through SMTP | James Armes</title> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> </head> <body> <div class="wrapper"> <section> <div id="title"> <h1> <a id="git-ic" href="https://github.com/jamesiarmes"><i class="fa fa-github"></i></a> <a id="so-ic" href="http://stackoverflow.com/users/62401/jamesarmes"><i class="fa fa-stack-overflow"></i></a> <a id="sitename" href="/">James Armes</a> </h1> <hr/> <span class="credits left"> <a href="/blog">Blog</a> | <a href="/archive">Archive</a> | <a href="/resume">Resume</a> | <a href="/about">About</a> </span> <span class="credits right"> </span> </div> <div class="post-title"> <h1>Sending Mail In PHP Through SMTP</h1> <p class="text-muted">15 Nov 2008 | <i class="fa fa-tag"></i> <a class="text-muted" href="/tags/#Mail">Mail</a>, <a class="text-muted" href="/tags/#PEAR">PEAR</a>, <a class="text-muted" href="/tags/#PHP">PHP</a>, <a class="text-muted" href="/tags/#SMTP">SMTP</a> </p> </div> <p>Sending mail is a common task for many applications today. Whether sending mail through a webform or as an automated tasks, sending mail can be simple using PHP and PEAR. Using the sendMail() function below, you can send HTML formatted mail through any smtp server.</p> <p><em><strong>Update March 11, 2009:</strong> Removed the demo since GoDaddy does not support external SMTP servers.</em> <em><strong>Update July 06, 2009:</strong> Updated variables for the usage example to be less confusing. Thanks to David for pointing this out.</em></p> <p>This function requires the following <a href="http://pear.php.net">PEAR</a> classes along any of their dependencies.</p> <ul> <li><a href="http://pear.php.net/package/Mail">Mail</a></li> <li><a href="http://pear.php.net/package/Mail_Mime">Mail_Mime</a></li> <li><a href="http://pear.php.net/package/Net_SMTP">Net_SMTP</a></li> </ul> <p>This function assumes that you have your pear include path set correctly. You can download the function <a href="/sites/default/files/blog/sendmail.php">here</a> (right click -&gt; Save Link As) or copy the code from below. Scroll down for some examples/documentation.</p> <figure class="highlight"><pre><code class="language-php" data-lang="php">/**
 * Sends mail by connecting to an smtp server
 * 
 * @param string $subject
 * @param string $smtp_server
 * @param string $smtp_username
 * @param string $smtp_password
 * @param string $html html portion of the message body
 * @param string $text text portion of the message body
 * @param string|array $to
 * @param string $from
 * @param array $cc
 * @param array $bcc
 * @return boolean|string
 */
function sendMail($subject, $smtp_server, $smtp_username, $smtp_password,
    $html, $text, $to, $from, $cc = array(), $bcc = array()) {
    // require pear classes
    require_once 'Mail.php';
    require_once 'Mail/mime.php';
    
    // create the heaers
    $to = is_array($to) ? $to : explode(',', $to);
    $headers = array(
        'Subject' =&gt; $subject,
        'From' =&gt; $from,
        'To' =&gt; implode(',', $to),
    ); // end $headers
    
    // create the message
    $mime = new Mail_mime("\n");
    $mime-&gt;addCc(implode(',', $cc));
    $mime-&gt;addBcc(implode(',', $bcc));
    $mime-&gt;setTXTBody($text);
    $mime-&gt;setHTMLBody($html);
    
    // always call these methods in this order
    $body = $mime-&gt;get();
    $headers = $mime-&gt;headers($headers);
    
    // create the smtp mail object
    $smtp_params = array(
        'host' =&gt; $smtp_server,
        'auth' =&gt; true,
        'username' =&gt; $smtp_username,
        'password' =&gt; $smtp_password,
        'timeout' =&gt; 20,
        'localhost' =&gt; $_SERVER['SERVER_NAME'],
    ); // end $smtp_params
    $smtp = Mail::factory('smtp', $smtp_params);
    
    // send the message
    $recipients = array_merge($to, $cc, $bcc);
    $mail = $smtp-&gt;send($recipients, $headers, $body);
    
    // check to make sure there was no error
    if (PEAR::isError($mail)) {
        return $mail-&gt;getMessage();
    } // end if there was an error
    
    return true;
}</code></pre></figure> <p>Using this function is simple. Simply pass in the parameters as described below:</p> <ul> <li>$subject (required): Subject for the email message.</li> <li>$smtp_server (required): SMTP Server host (ie. smtp.hostname.com).</li> <li>$smtp_username (required): SMTP username.</li> <li>$smtp_password (required): SMTP password.</li> <li>$html (required): HTML version of the message body.</li> <li>$text (required): Text version of the message body.</li> <li>$to (required): String or array of email address to send the message to (string may be comma separated list).</li> <li>$from (required): Email address that the email is being sent from.</li> <li>$cc (optional): Array of Cc email addresses.</li> <li>$bcc (optional): Array of Bcc email addresses.</li> </ul> <p>For example:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php">// set all of the parameters
$subject = 'This is an HTML email.';
$smtp_server = 'smtp.hostname.com';
$from = $smtp_username = 'user@hostname.com';
$smtp_password = 'password';
$html = 'This is an <span class="nt">&lt;strong&gt;</span>HTML<span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;i&gt;</span>formatted<span class="nt">&lt;/i&gt;</span> email!';
$text = strip_tags($html);
$to = 'email@example.com';
$cc = array('foo@example.com');
$bcc  array('bar@example.com', 'baz@example.com');

// send the message
$result = sendMail($subject, $smtp_server, $smtp_username, $smtp_password, $html, $text, $to, $cc, $bcc);

// check to see if the message was sent properly
if ($result !== true) {
    echo 'There was an error sending the message. ('.$result.')';
} // end if the message was not sent properly
else {
    echo 'Message sent successfully.';
} // end else the message was sent properly</code></pre></figure> <div class="share-btns"> <h4>Share this post:</h4> <a class="btn btn-small btn-sm twitter" href="http://twitter.com/share?text=Sending Mail In PHP Through SMTP" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"> <i class="fa fa-twitter fa-lg"></i> Twitter </a> <a class="btn btn-small btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"> <i class="fa fa-facebook fa-lg"></i> Facebook </a> <a class="btn btn-small btn-sm gplus" onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;"> <i class="fa fa-google-plus fa-lg"></i> Google+ </a> </a> </div> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="jamesarmes";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> </div> <div class="post-footer"> </div> <hr/> <div class="post-navs row"> <div class="col-md-6 post-nav"> <h3 class="section-header"> Older <span class="text-muted"> &middot; </span> <a href="/archive">View Archive (33)</a> </h3> <h2 class="post-title-link"><a href="/blog/2008/11/accessing-harrisdata-ibm-iseries-php">Accessing HarrisData (IBM iSeries) In PHP</a></h2> <p><img src="/assets/images/2008/11/harrisdata_logo.png" alt="HarrisData" class="post-image image-right"/> I have recently been working on a project to integrate with a <a href="http://www.harrisdata.com">HarrisData</a> ERP Application. The Application runs on an IBM iSeries (AS/400). I used PHP’s built in PDO object with the ODBC extension. Using PDO, I was able to execute SQL Queries on the server. IBM systems use IBM’s DB2 syntax. This entry will outline some of the basic steps, in PHP, to communicate with the system</p> </div> <div class="col-md-6 post-nav"> <h3 class="section-header"> Newer </h3> <h2 class="post-title-link"><a href="/blog/2009/03/vcards-mozilla-thunderbird">vcards In Mozilla Thunderbird</a></h2> <p>Lately, I have been constantly switching between both operating systems and mail clients. I became quite fond of <a href="http://kontact.kde.org/">Kontact</a>, KDE’s PIM suite, long ago. The only thing that stopped me from switching over to it full time was its lack of support for HTML signatures. As of the KDE 4 release of Kontact, support has been added for HTML signatures. I decided to make the switch back to Kontact earlier this week.</p> </div> </div> <footer> <hr/> <div class="left"> &copy;2016 James Armes. </div> <div class="right"> <a href="https://twitter.com/jamesiarmes"><i class="fa fa-twitter fa-lg" style="color:#49B1F7;"></i></a> </a> </div> </footer> </section> </div> </div> <script src="/public/javascripts/jquery.min.js"></script> <script src="/public/javascripts/bootstrap.min.js"></script> <script type="text/javascript">var disqus_shortname="jamesarmes";!function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(e)}();</script> <script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-3412924-2","auto"),ga("send","pageview");</script> </body> </html>